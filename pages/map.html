<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hemope DoeMais</title>
    <link rel="stylesheet" href="../assets/css/global.css">
    <link rel="stylesheet" href="../assets/css/map.css">
    <link rel="icon" href="../assets/img/logo/logo_simbolo.png" type="image/x-icon">

</head>

<body>

    <header class="topbar">
        <div class="logo-area">
            <a href="../index.html"><img src="../assets/img/logo/logo_caligrafia_branca.png" alt="Hemope DoeMais"
                    class="logo"></a>
        </div>

        <nav class="navbar">
            <a href="map.html" class="active">Mapa Interativo</a>
            <a href="ranking.html">Ranking de Doadores</a>
            <a href="donor.html">Seja um doador</a>
        </nav>

        <div class="search-area">
            <input type="text" placeholder="Buscar cidade" id="search-input">
            <button id="search-btn"><img src="../assets/img/icons/lupa.png"></button>
        </div>
    </header>

    <main class="container">

        <aside class="sidebar">
            <h4>Agreste Meridional de Pernambuco</h4>
            <h2>Pontuação Geral</h2>

            <hr>

            <h3>Legenda</h3>
            <ul class="legenda">
                <li><span class="cor muito-alto"></span> Muito alto - 80 a 90</li>
                <li><span class="cor alto"></span> Alto - 60 a 79,99</li>
                <li><span class="cor medio"></span> Médio - 50 a 59,99</li>
                <li><span class="cor baixo"></span> Baixo - 40 a 49,99</li>
                <li><span class="cor muito-baixo"></span> Muito baixo - 0 a 39,99</li>
                <li><span class="cor indisponivel"></span> Informação Indisponível</li>
            </ul>

            <hr>

            <div class="descricao">
                <h3>Descrição</h3>
                <p>
                    O mapa exibe o nível de engajamento dos municípios na doação de sangue. Cada município é
                    representado por uma cor, indicando o volume de doações registradas pelo HEMOPE ao longo do período
                    analisado.
                </p>
                <p>
                    A pontuação é calculada com base no número total de doadores ativos, frequência das doações e
                    participação em campanhas de incentivo. Quanto mais elevado o índice, maior o comprometimento do
                    município com a doação de sangue.
                </p>
            </div>

            <hr>

            <div class="btn-container">
                <a href="donor.html"><button class="btn-doador">Quero ser doador</button></a>
            </div>

        </aside>

        <section class="map-area">
            <div id="map-div">
                <iframe id="map" src="object/map_object.html" title="Descrição do conteúdo">
                    Seu navegador não suporta iframes.
                </iframe>
            </div>

            <div class="top-doadores-card">
                <a href="ranking.html"><img src="../assets/img/top-3-doadores.png" alt=""></a>
            </div>

        </section>

    </main>

    <script src="assets/js/main.js"></script>
    <script src="assets/js/map.js"></script>
    <script src="../assets/js/map_script.js"></script>

    <script>
        // Salvar conteúdo inicial do sidebar
        let sidebarOriginal = null;
    </script>


    <script>
        window.addEventListener("message", (event) => {
            if (event.data.action === "updateCitySidebar") {
                const city = event.data.city;

                // Se ainda não salvou o sidebar original, salvar agora
                if (!sidebarOriginal) {
                    sidebarOriginal = document.querySelector(".sidebar").innerHTML;
                }

                // Substitui conteúdo do sidebar
                document.querySelector(".sidebar").innerHTML = `
            <div class="sidebar-title">
                <div class="sidebar-text">
                    <h4>Agreste Meridional de Pernambuco</h4>
                    <h2>Pontuação Geral</h2>
                </div>
                <button id="sidebar-back" class="back-btn">X</button>
            </div>

            <hr>
            
            <div class="city-info">
                <img src="${city.img}" class="city-flag" alt="${city.nome}">
                <h2>${city.nome}</h2>
                
                <p><strong>Pontuação:</strong> ${city.score}</p>
                <p><strong>Classificação:</strong> ${city.score >= 80 ? "Muito alto" :
                        city.score >= 60 ? "Alto" :
                            city.score >= 50 ? "Médio" :
                                city.score >= 40 ? "Baixo" : "Muito Baixo"
                    }</p>

                <hr>

                <h3>Indicadores de Engajamento</h3>
                <p><strong>Número de Doadores Ativos:</strong> ${city.doacoes ?? "—"}</p>
                <p><strong>Doações Realizadas no Ano:</strong> ${city.ultimaDoacao ?? "—"}</p>
                <hr>

                <h3>Políticas Públicas Ativadas</h3>
                <p>Com certificação automática.</p>
                <table>
                    <tr>
                        <td><span class="cor alto"></span></td>
                        <td><strong><p> ${city.politicaAtiva ?? "—"} políticas ativas</strong></p></td>
                    </tr>
                    <tr>
                        <td><span class="cor medio"></span></td>
                        <td><strong><p> ${city.politicaAtiva ?? "—"} políticas em análise</strong></p></td>
                    </tr>
                    <tr>
                        <td><span class="cor indisponivel"></span></td>
                        <td><strong><p> ${city.politicaAtiva ?? "—"} políticas pendentes</strong></p></td>
                    </tr>                
                </table>

                <hr>

                <h3>Empresas Parceiras da Cidade</h3>
                <p><strong>Empresas certificadas:</strong> ${city.doacoes ?? "—"}</p>
                <p><strong>Certificados emitidos:</strong> ${city.doacoes ?? "—"}</p>
                <p><strong>Campanhas empresariais no ano:</strong> ${city.doacoes ?? "—"}</p>
                
                <hr>

                <div class="btn-container">
                <a href="donor.html"><button class="btn-doador">Quero ser doador</button></a>
            </div>

            </div>
        `;

                // Botão de voltar restaura sem reload
                document.getElementById("sidebar-back").addEventListener("click", () => {
                    document.querySelector(".sidebar").innerHTML = sidebarOriginal;
                });
            }
        });
    </script>

</body>

</html>